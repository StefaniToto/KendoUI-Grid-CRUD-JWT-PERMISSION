/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { FormControlService } from '../../services/form-control.service';
import * as _ from 'lodash';
import { PhoneCode } from '../../models/PhoneCode';
import { TinyMce } from '../../models/TinyMce';
import { CheckBox } from '../../models/CheckBox';
import { SwitchInput } from '../../models/SwitchInput';
import { SelectionByApi } from '../../models/SelectionByApi';
import { Select2 } from '../../models/Select2';
import { ListCheckBox } from '../../models/ListCheckBox';
export class ReactiveFormComponent {
    /**
     * @param {?} fcs
     */
    constructor(fcs) {
        this.fcs = fcs;
        this.groups = [];
        this.inputs = [];
        this.captchaCorrect = true;
        this.values = {};
        this.submitted = false;
        this.clear = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    onChangesReactive() {
        /** @type {?} */
        const $this = this;
        if (this.keysChange !== undefined) {
            _.forEach(this.keysChange, (/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                $this.form.get(value).valueChanges.subscribe((/**
                 * @param {?} val
                 * @return {?}
                 */
                val => {
                    $this.values[value] = val;
                    $this.form.value[value] = val;
                    $this.onChangeReactive.apply(null, [$this.form]);
                }));
            }));
        }
        else {
            this.form.valueChanges.subscribe((/**
             * @param {?} val
             * @return {?}
             */
            val => {
                if (this.onChangeReactive !== undefined) {
                    this.onChangeReactive.apply(null, [this.form]);
                }
            }));
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const groups = [];
        /** @type {?} */
        const grouped = _.groupBy(this.inputs, 'group');
        // tslint:disable-next-line:forin
        for (const k in grouped) {
            groups.push({
                group: k,
                items: grouped[k],
                classes: _.head(grouped[k]).group_classes
            });
        }
        this.groups = groups;
        this.form = this.fcs.toFormGroup(this.inputs);
        this.onChangesReactive();
    }
    /**
     * @return {?}
     */
    submit() {
        this.submitted = true;
        if (this.form.invalid) {
            return false;
        }
        if (this.captcha && this.form.value[`${this.captcha}`].value !== this.form.value[`${this.captcha}`].code) {
            this.captchaCorrect = false;
            return false;
        }
        this.captchaCorrect = true;
        if (this.onSubmit !== undefined) {
            delete this.form.value[''];
            this.onSubmit.apply(null, [this.form]);
        }
        this.clear = false;
        if (!this.saveValue || this.saveValue === false) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.clearData();
            }), 2);
        }
    }
    /**
     * @return {?}
     */
    resetFunction() {
        if (confirm('Are you sure want to reset this form?')) {
            this.clearData();
        }
    }
    /**
     * @return {?}
     */
    customSubmitFunction() {
        this.submitted = true;
        if (this.form.invalid) {
            return false;
        }
        if (this.customSubmit !== undefined) {
            delete this.form.value[''];
            this.customSubmit.apply(null, [this.form]);
        }
        this.clear = false;
    }
    /**
     * @return {?}
     */
    customButtonFunction() {
        if (this.customButton !== undefined) {
            this.customButton.apply(null, []);
        }
    }
    /**
     * @return {?}
     */
    clearData() {
        this.clear = true;
        this.submitted = false;
        /** @type {?} */
        const data = {};
        _.forEach(this.inputs, (/**
         * @param {?} input
         * @return {?}
         */
        input => {
            if (input.controlType === new PhoneCode().controlType) {
                data[input.key] = {
                    code: '',
                    value: ''
                };
            }
            if (input.controlType === new TinyMce().controlType) {
                data[input.key] = '';
            }
            if (input.controlType === new CheckBox().controlType || input.controlType === new SwitchInput().controlType) {
                input.value = false;
            }
            if (input.controlType === new SelectionByApi().controlType) {
                input.value = null;
            }
            if (input.controlType === new Select2().controlType || input.controlType === new ListCheckBox().controlType) {
                input.value = [];
            }
        }));
        this.form.reset(data);
        _.forEach(this.inputs, (/**
         * @param {?} input
         * @return {?}
         */
        input => {
            if (input.controlType === new CheckBox().controlType || input.controlType === new SwitchInput().controlType) {
                input.value = false;
            }
            if (input.controlType === new SelectionByApi().controlType) {
                input.value = null;
            }
            if (input.controlType === new Select2().controlType || input.controlType === new ListCheckBox().controlType) {
                input.value = [];
            }
        }));
        this.form.markAsPristine();
        this.form.markAsUntouched();
    }
}
ReactiveFormComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'reactive-form',
                template: "<form (ngSubmit)=\"submit()\" [formGroup]=\"form\">\r\n  <div class=\"row\">\r\n    <div class=\"dynamic-collection\" *ngFor=\"let group of groups\" [ngClass]=\"group.classes\">\r\n      <div class=\"row\">\r\n        <div *ngFor=\"let input of group.items\" class=\"dynamic-input-group\" [ngClass]=\"input.classes\">\r\n          <dynamic-input\r\n            [captchaCorrect]=\"captchaCorrect\"\r\n            [isClear]=\"clear\"\r\n            [input]=\"input\"\r\n            [form]=\"form\"\r\n            [submitted]=\"submitted\"\r\n          ></dynamic-input>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"dynamic-submit-btn\">\r\n    <button type=\"submit\" [ngClass]=\"{ disabled: !form.valid }\" class=\"btn btn-primary m-r-15 ripple light\">\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ submitText !== undefined ? submitText : 'Submit' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"isReset !== undefined && isReset === true\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"resetFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ resetText !== undefined ? resetText : 'Reset' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"customSubmit !== undefined\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"customSubmitFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ customeSubmitText !== undefined ? customeSubmitText : 'Custom Submit' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"customButton !== undefined\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"customButtonFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ customButtonText !== undefined ? customButtonText : 'Custom Button' }}\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                providers: [FormControlService],
                styles: [":host .dynamic-collection{margin-bottom:10px}:host .btn-reset{float:right}:host .rf__captcha--error{margin-top:15px;color:#e74c3c;font-size:15px}"]
            }] }
];
/** @nocollapse */
ReactiveFormComponent.ctorParameters = () => [
    { type: FormControlService }
];
ReactiveFormComponent.propDecorators = {
    inputs: [{ type: Input }],
    onSubmit: [{ type: Input }],
    submitText: [{ type: Input }],
    onChangeReactive: [{ type: Input }],
    keysChange: [{ type: Input }],
    isReset: [{ type: Input }],
    resetText: [{ type: Input }],
    customSubmit: [{ type: Input }],
    customButton: [{ type: Input }],
    customeSubmitText: [{ type: Input }],
    customButtonText: [{ type: Input }],
    saveValue: [{ type: Input }],
    captcha: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ReactiveFormComponent.prototype.groups;
    /** @type {?} */
    ReactiveFormComponent.prototype.inputs;
    /** @type {?} */
    ReactiveFormComponent.prototype.onSubmit;
    /** @type {?} */
    ReactiveFormComponent.prototype.submitText;
    /** @type {?} */
    ReactiveFormComponent.prototype.onChangeReactive;
    /** @type {?} */
    ReactiveFormComponent.prototype.keysChange;
    /** @type {?} */
    ReactiveFormComponent.prototype.isReset;
    /** @type {?} */
    ReactiveFormComponent.prototype.resetText;
    /** @type {?} */
    ReactiveFormComponent.prototype.customSubmit;
    /** @type {?} */
    ReactiveFormComponent.prototype.customButton;
    /** @type {?} */
    ReactiveFormComponent.prototype.customeSubmitText;
    /** @type {?} */
    ReactiveFormComponent.prototype.customButtonText;
    /** @type {?} */
    ReactiveFormComponent.prototype.saveValue;
    /** @type {?} */
    ReactiveFormComponent.prototype.captcha;
    /** @type {?} */
    ReactiveFormComponent.prototype.captchaCorrect;
    /** @type {?} */
    ReactiveFormComponent.prototype.values;
    /** @type {?} */
    ReactiveFormComponent.prototype.form;
    /** @type {?} */
    ReactiveFormComponent.prototype.submitted;
    /** @type {?} */
    ReactiveFormComponent.prototype.clear;
    /**
     * @type {?}
     * @private
     */
    ReactiveFormComponent.prototype.fcs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhY3RpdmUtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXJlYWN0aXZlLWZvcm0vIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9yZWFjdGl2ZS1mb3JtL3JlYWN0aXZlLWZvcm0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFbkYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDekUsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFFNUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBU3pELE1BQU0sT0FBTyxxQkFBcUI7Ozs7SUFxQmhDLFlBQW9CLEdBQXVCO1FBQXZCLFFBQUcsR0FBSCxHQUFHLENBQW9CO1FBcEIzQyxXQUFNLEdBQXFCLEVBQUUsQ0FBQztRQUNyQixXQUFNLEdBQXFCLEVBQUUsQ0FBQztRQWF2QyxtQkFBYyxHQUFHLElBQUksQ0FBQztRQUV0QixXQUFNLEdBQVEsRUFBRSxDQUFDO1FBRWpCLGNBQVMsR0FBWSxLQUFLLENBQUM7UUFDM0IsVUFBSyxHQUFZLEtBQUssQ0FBQztJQUN1QixDQUFDOzs7O0lBRS9DLFFBQVEsS0FBSSxDQUFDOzs7O0lBRWIsaUJB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QUNuQywwQ0FBNkI7O0lBQzdCLHdDQUEwQjs7SUFDMUIsK0NBQXNCOztJQUV0Qix1Q0FBaUI7O0lBQ2pCLHFDQUFnQjs7SUFDaEIsMENBQTJCOztJQUMzQixzQ0FBdUI7Ozs7O0lBQ1gsb0NBQStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSW5wdXRCYXNlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL0lucHV0QmFzZSc7XHJcbmltcG9ydCB7IEZvcm1Db250cm9sU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2Zvcm0tY29udHJvbC5zZXJ2aWNlJztcclxuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xyXG5pbXBvcnQgeyBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IFBob25lQ29kZSB9IGZyb20gJy4uLy4uL21vZGVscy9QaG9uZUNvZGUnO1xyXG5pbXBvcnQgeyBUaW55TWNlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL1RpbnlNY2UnO1xyXG5pbXBvcnQgeyBDaGVja0JveCB9IGZyb20gJy4uLy4uL21vZGVscy9DaGVja0JveCc7XHJcbmltcG9ydCB7IFN3aXRjaElucHV0IH0gZnJvbSAnLi4vLi4vbW9kZWxzL1N3aXRjaElucHV0JztcclxuaW1wb3J0IHsgU2VsZWN0aW9uQnlBcGkgfSBmcm9tICcuLi8uLi9tb2RlbHMvU2VsZWN0aW9uQnlBcGknO1xyXG5pbXBvcnQgeyBTZWxlY3QyIH0gZnJvbSAnLi4vLi4vbW9kZWxzL1NlbGVjdDInO1xyXG5pbXBvcnQgeyBMaXN0Q2hlY2tCb3ggfSBmcm9tICcuLi8uLi9tb2RlbHMvTGlzdENoZWNrQm94JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjb21wb25lbnQtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ3JlYWN0aXZlLWZvcm0nLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9yZWFjdGl2ZS1mb3JtLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9yZWFjdGl2ZS1mb3JtLmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbRm9ybUNvbnRyb2xTZXJ2aWNlXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUmVhY3RpdmVGb3JtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIGdyb3VwczogSW5wdXRCYXNlPGFueT5bXSA9IFtdO1xyXG4gIEBJbnB1dCgpIGlucHV0czogSW5wdXRCYXNlPGFueT5bXSA9IFtdO1xyXG4gIEBJbnB1dCgpIG9uU3VibWl0PzogRnVuY3Rpb247XHJcbiAgQElucHV0KCkgc3VibWl0VGV4dD86IFN0cmluZztcclxuICBASW5wdXQoKSBvbkNoYW5nZVJlYWN0aXZlPzogRnVuY3Rpb247XHJcbiAgQElucHV0KCkga2V5c0NoYW5nZT86IGFueTtcclxuICBASW5wdXQoKSBpc1Jlc2V0PzogQm9vbGVhbjtcclxuICBASW5wdXQoKSByZXNldFRleHQ/OiBTdHJpbmc7XHJcbiAgQElucHV0KCkgY3VzdG9tU3VibWl0PzogRnVuY3Rpb247XHJcbiAgQElucHV0KCkgY3VzdG9tQnV0dG9uPzogRnVuY3Rpb247XHJcbiAgQElucHV0KCkgY3VzdG9tZVN1Ym1pdFRleHQ/OiBTdHJpbmc7XHJcbiAgQElucHV0KCkgY3VzdG9tQnV0dG9uVGV4dD86IFN0cmluZztcclxuICBASW5wdXQoKSBzYXZlVmFsdWU/OiBCb29sZWFuO1xyXG4gIEBJbnB1dCgpIGNhcHRjaGE/OiBTdHJpbmc7XHJcbiAgY2FwdGNoYUNvcnJlY3QgPSB0cnVlO1xyXG5cclxuICB2YWx1ZXM6IGFueSA9IHt9O1xyXG4gIGZvcm06IEZvcm1Hcm91cDtcclxuICBzdWJtaXR0ZWQ6IEJvb2xlYW4gPSBmYWxzZTtcclxuICBjbGVhcjogQm9vbGVhbiA9IGZhbHNlO1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZmNzOiBGb3JtQ29udHJvbFNlcnZpY2UpIHt9XHJcblxyXG4gIG5nT25Jbml0KCkge31cclxuXHJcbiAgb25DaGFuZ2VzUmVhY3RpdmUoKSB7XHJcbiAgICBjb25zdCAkdGhpcyA9IHRoaXM7XHJcbiAgICBpZiAodGhpcy5rZXlzQ2hhbmdlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgXy5mb3JFYWNoKHRoaXMua2V5c0NoYW5nZSwgZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAkdGhpcy5mb3JtLmdldCh2YWx1ZSkudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2YWwgPT4ge1xyXG4gICAgICAgICAgJHRoaXMudmFsdWVzW3ZhbHVlXSA9IHZhbDtcclxuICAgICAgICAgICR0aGlzLmZvcm0udmFsdWVbdmFsdWVdID0gdmFsO1xyXG4gICAgICAgICAgJHRoaXMub25DaGFuZ2VSZWFjdGl2ZS5hcHBseShudWxsLCBbJHRoaXMuZm9ybV0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZm9ybS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHZhbCA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMub25DaGFuZ2VSZWFjdGl2ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICB0aGlzLm9uQ2hhbmdlUmVhY3RpdmUuYXBwbHkobnVsbCwgW3RoaXMuZm9ybV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBjb25zdCBncm91cHMgPSBbXTtcclxuICAgIGNvbnN0IGdyb3VwZWQgPSBfLmdyb3VwQnkodGhpcy5pbnB1dHMsICdncm91cCcpO1xyXG5cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpmb3JpblxyXG4gICAgZm9yIChjb25zdCBrIGluIGdyb3VwZWQpIHtcclxuICAgICAgZ3JvdXBzLnB1c2goe1xyXG4gICAgICAgIGdyb3VwOiBrLFxyXG4gICAgICAgIGl0ZW1zOiBncm91cGVkW2tdLFxyXG4gICAgICAgIGNsYXNzZXM6IF8uaGVhZChncm91cGVkW2tdKS5ncm91cF9jbGFzc2VzXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5ncm91cHMgPSBncm91cHM7XHJcbiAgICB0aGlzLmZvcm0gPSB0aGlzLmZjcy50b0Zvcm1Hcm91cCh0aGlzLmlucHV0cyk7XHJcbiAgICB0aGlzLm9uQ2hhbmdlc1JlYWN0aXZlKCk7XHJcbiAgfVxyXG5cclxuICBzdWJtaXQoKSB7XHJcbiAgICB0aGlzLnN1Ym1pdHRlZCA9IHRydWU7XHJcbiAgICBpZiAodGhpcy5mb3JtLmludmFsaWQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY2FwdGNoYSAmJiB0aGlzLmZvcm0udmFsdWVbYCR7dGhpcy5jYXB0Y2hhfWBdLnZhbHVlICE9PSB0aGlzLmZvcm0udmFsdWVbYCR7dGhpcy5jYXB0Y2hhfWBdLmNvZGUpIHtcclxuICAgICAgdGhpcy5jYXB0Y2hhQ29ycmVjdCA9IGZhbHNlO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNhcHRjaGFDb3JyZWN0ID0gdHJ1ZTtcclxuXHJcbiAgICBpZiAodGhpcy5vblN1Ym1pdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGRlbGV0ZSB0aGlzLmZvcm0udmFsdWVbJyddO1xyXG4gICAgICB0aGlzLm9uU3VibWl0LmFwcGx5KG51bGwsIFt0aGlzLmZvcm1dKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNsZWFyID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKCF0aGlzLnNhdmVWYWx1ZSB8fCB0aGlzLnNhdmVWYWx1ZSA9PT0gZmFsc2UpIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbGVhckRhdGEoKTtcclxuICAgICAgfSwgMik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXNldEZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB3YW50IHRvIHJlc2V0IHRoaXMgZm9ybT8nKSkge1xyXG4gICAgICB0aGlzLmNsZWFyRGF0YSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY3VzdG9tU3VibWl0RnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLnN1Ym1pdHRlZCA9IHRydWU7XHJcbiAgICBpZiAodGhpcy5mb3JtLmludmFsaWQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY3VzdG9tU3VibWl0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgZGVsZXRlIHRoaXMuZm9ybS52YWx1ZVsnJ107XHJcbiAgICAgIHRoaXMuY3VzdG9tU3VibWl0LmFwcGx5KG51bGwsIFt0aGlzLmZvcm1dKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2xlYXIgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGN1c3RvbUJ1dHRvbkZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKHRoaXMuY3VzdG9tQnV0dG9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy5jdXN0b21CdXR0b24uYXBwbHkobnVsbCwgW10pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xlYXJEYXRhKCkge1xyXG4gICAgdGhpcy5jbGVhciA9IHRydWU7XHJcbiAgICB0aGlzLnN1Ym1pdHRlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgZGF0YSA9IHt9O1xyXG4gICAgXy5mb3JFYWNoKHRoaXMuaW5wdXRzLCBpbnB1dCA9PiB7XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFBob25lQ29kZSgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgZGF0YVtpbnB1dC5rZXldID0ge1xyXG4gICAgICAgICAgY29kZTogJycsXHJcbiAgICAgICAgICB2YWx1ZTogJydcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFRpbnlNY2UoKS5jb250cm9sVHlwZSkge1xyXG4gICAgICAgIGRhdGFbaW5wdXQua2V5XSA9ICcnO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IENoZWNrQm94KCkuY29udHJvbFR5cGUgfHwgaW5wdXQuY29udHJvbFR5cGUgPT09IG5ldyBTd2l0Y2hJbnB1dCgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaW5wdXQuY29udHJvbFR5cGUgPT09IG5ldyBTZWxlY3Rpb25CeUFwaSgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFNlbGVjdDIoKS5jb250cm9sVHlwZSB8fCBpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IExpc3RDaGVja0JveCgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSBbXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLmZvcm0ucmVzZXQoZGF0YSk7XHJcbiAgICBfLmZvckVhY2godGhpcy5pbnB1dHMsIGlucHV0ID0+IHtcclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgQ2hlY2tCb3goKS5jb250cm9sVHlwZSB8fCBpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFN3aXRjaElucHV0KCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFNlbGVjdGlvbkJ5QXBpKCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgU2VsZWN0MigpLmNvbnRyb2xUeXBlIHx8IGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgTGlzdENoZWNrQm94KCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IFtdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmZvcm0ubWFya0FzUHJpc3RpbmUoKTtcclxuICAgIHRoaXMuZm9ybS5tYXJrQXNVbnRvdWNoZWQoKTtcclxuICB9XHJcbn1cclxuIl19