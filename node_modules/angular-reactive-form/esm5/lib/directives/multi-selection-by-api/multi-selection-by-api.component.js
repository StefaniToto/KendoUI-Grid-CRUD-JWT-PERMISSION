/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, forwardRef, Injector } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import * as _ from 'lodash';
import { SelectionService } from '../selection-by-api/selection-by-api';
var MultiSelectionByApiComponent = /** @class */ (function () {
    function MultiSelectionByApiComponent(api, injector) {
        var _this = this;
        this.api = api;
        this.injector = injector;
        this.isShow = false;
        this.result = [];
        this.url = (/**
         * @param {?} apiUrl
         * @param {?} search
         * @return {?}
         */
        function (apiUrl, search) {
            return apiUrl + _this.apiUpload + search;
        });
        this.propagateChange = (/**
         * @param {?} val
         * @return {?}
         */
        function (val) { });
    }
    /**
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (_this.value) {
                _this.result = _this.value;
            }
        }), 1);
    };
    /**
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.isClear === true) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.value = [];
                _this.result = [];
                _.forEach(_this.options, (/**
                 * @param {?} value
                 * @return {?}
                 */
                function (value) {
                    value.selected = false;
                }));
                _this.mapOptionsResult(_this.options, _this.result);
            }), 1);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.filterData = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        /** @type {?} */
        var UPLOAD_DIRECTIVE_HEADERS = this.injector.get('UPLOAD_DIRECTIVE_HEADERS');
        /** @type {?} */
        var UPLOAD_DIRECTIVE_API_URL = this.injector.get('UPLOAD_DIRECTIVE_API_URL');
        if (event.length >= this.lengthToSearch) {
            /** @type {?} */
            var api = this.url(UPLOAD_DIRECTIVE_API_URL, event);
            /** @type {?} */
            var requestHeaders = UPLOAD_DIRECTIVE_HEADERS;
            this.api.getAll(api, requestHeaders, this.method).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                _this.options = _this.resultTransformer(response);
                _this.mapOptionsResult(_this.options, _this.result);
            }));
            this.isShow = true;
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.detailClick = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var $this = this;
        if (item.selected) {
            _.remove(this.result, (/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return JSON.stringify(n) === JSON.stringify(item);
            }));
            _.forEach(this.options, (/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                if (JSON.stringify(value) === JSON.stringify(item)) {
                    value.selected = false;
                }
            }));
            this.mapOptionsResult(this.options, this.result);
            this.isShow = false;
            this.value = this.result;
        }
        else {
            this.result.push(item);
            this.mapOptionsResult(this.options, this.result);
            this.isShow = false;
            this.value = this.result;
        }
    };
    /**
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.changeStatusOptions = /**
     * @return {?}
     */
    function () {
        this.isShow === false ? (this.isShow = true) : (this.isShow = false);
    };
    /**
     * @param {?} array
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype._isEmpty = /**
     * @param {?} array
     * @return {?}
     */
    function (array) {
        return _.isEmpty(array) ? true : false;
    };
    /**
     * @param {?} item
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.removeItem = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var $this = this;
        _.remove(this.result, (/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return JSON.stringify(n) === JSON.stringify(item);
        }));
        _.forEach(this.options, (/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (JSON.stringify(value) === JSON.stringify(item)) {
                value.selected = false;
            }
        }));
        this.mapOptionsResult(this.options, this.result);
        this.isShow = false;
        this.value = this.result;
    };
    /**
     * @param {?} options
     * @param {?} result
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.mapOptionsResult = /**
     * @param {?} options
     * @param {?} result
     * @return {?}
     */
    function (options, result) {
        _.map(options, (/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            _.forEach(result, (/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                if (JSON.stringify(item) === JSON.stringify(value)) {
                    item.selected = true;
                }
            }));
        }));
        this.options = options;
    };
    Object.defineProperty(MultiSelectionByApiComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._value = val;
            this.propagateChange(this._value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value !== undefined) {
            this.value = value;
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.propagateChange = fn;
    };
    /**
     * @return {?}
     */
    MultiSelectionByApiComponent.prototype.registerOnTouched = /**
     * @return {?}
     */
    function () { };
    MultiSelectionByApiComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'multi-selection-by-api',
                    template: "<div class=\"form-group selection-group\">\n  <div class=\"form-control\" id=\"multi-selection-by-api-reactive-form\" (click)=\"changeStatusOptions()\">\n    <span class=\"name-tag\" *ngFor=\"let item of result\">\n      {{ fieldName(item) }} <i class=\"fa fa-times remove-options-selection-reactive\" aria-hidden=\"true\" (click)=\"removeItem(item)\"></i>\n    </span>\n  </div>\n  <div *ngIf=\"isShow\" id=\"multil-options-group-reactive-form\">\n    <input\n      autocomplete=\"off\"\n      id=\"search-multi-selection-by-api-reactive-form\"\n      class=\"form-control search-text\"\n      type=\"text\"\n      name=\"search\"\n      #search\n      [(ngModel)]=\"text\"\n      (ngModelChange)=\"filterData(search.value)\"\n    />\n    <div *ngIf=\"options\">\n      <p *ngFor=\"let item of options\" [ngClass]=\"item.selected ? 'selected' : 'unselected'\" (click)=\"detailClick(item)\">{{ fieldName(item) }}</p>\n    </div>\n    <div *ngIf=\"_isEmpty(options)\"><p>Resource not found</p></div>\n  </div>\n</div>\n",
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return MultiSelectionByApiComponent; })),
                            multi: true
                        },
                        SelectionService
                    ],
                    styles: [".selection-group{position:relative}#multil-options-group-reactive-form{position:absolute;border:1px solid #d3d3d3;border-radius:5px;width:100%;z-index:9;background-color:#fff;border-top:none;padding:10px}#multil-options-group-reactive-form p{cursor:pointer;padding:.375rem .75rem;margin:0}#multil-options-group-reactive-form .unselected:hover{background-color:#6495ed;color:#fff}.name-tag{padding:3px 5px;background-color:#dcdcdc;border:1px solid grey;border-radius:5px;margin-right:5px}.selected{background-color:#c5c5c5}"]
                }] }
    ];
    /** @nocollapse */
    MultiSelectionByApiComponent.ctorParameters = function () { return [
        { type: SelectionService },
        { type: Injector }
    ]; };
    MultiSelectionByApiComponent.propDecorators = {
        _value: [{ type: Input }],
        resultTransformer: [{ type: Input }],
        apiUpload: [{ type: Input }],
        headers: [{ type: Input }],
        fieldName: [{ type: Input }],
        lengthToSearch: [{ type: Input }],
        isClear: [{ type: Input }],
        method: [{ type: Input }]
    };
    return MultiSelectionByApiComponent;
}());
export { MultiSelectionByApiComponent };
if (false) {
    /** @type {?} */
    MultiSelectionByApiComponent.prototype._value;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.resultTransformer;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.apiUpload;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.headers;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.fieldName;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.lengthToSearch;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.isClear;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.method;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.text;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.options;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.isShow;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.result;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.url;
    /** @type {?} */
    MultiSelectionByApiComponent.prototype.propagateChange;
    /**
     * @type {?}
     * @private
     */
    MultiSelectionByApiComponent.prototype.api;
    /**
     * @type {?}
     * @private
     */
    MultiSelectionByApiComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktc2VsZWN0aW9uLWJ5LWFwaS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXJlYWN0aXZlLWZvcm0vIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9tdWx0aS1zZWxlY3Rpb24tYnktYXBpL211bHRpLXNlbGVjdGlvbi1ieS1hcGkuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQW9DLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RyxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFHeEU7SUE4QkUsc0NBQW9CLEdBQXFCLEVBQVUsUUFBa0I7UUFBckUsaUJBQXlFO1FBQXJELFFBQUcsR0FBSCxHQUFHLENBQWtCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUw5RCxXQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ2YsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLFFBQUc7Ozs7O1FBQUcsVUFBQyxNQUFNLEVBQUUsTUFBTTtZQUMxQixPQUFPLE1BQU0sR0FBRyxLQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztRQUMxQyxDQUFDLEVBQUE7UUFFRCxvQkFBZTs7OztRQUFHLFVBQUMsR0FBUSxJQUFNLENBQUMsRUFBQztJQURxQyxDQUFDOzs7O0lBR3pFLHNEQUFlOzs7SUFBZjtRQUFBLGlCQU1DO1FBTEMsVUFBVTs7O1FBQUM7WUFDVCxJQUFJLEtBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ2QsS0FBSSxDQUFDLE1BQU0sR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDO2FBQzFCO1FBQ0gsQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ1IsQ0FBQzs7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LE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsRUFBRSxVQUFVOzs7NEJBQUMsY0FBTSxPQUFBLDRCQUE0QixFQUE1QixDQUE0QixFQUFDOzRCQUMzRCxLQUFLLEVBQUUsSUFBSTt5QkFDWjt3QkFDRCxnQkFBZ0I7cUJBQ2pCOztpQkFDRjs7OztnQkFoQlEsZ0JBQWdCO2dCQUhnRCxRQUFROzs7eUJBcUI5RSxLQUFLO29DQUNMLEtBQUs7NEJBQ0wsS0FBSzswQkFDTCxLQUFLOzRCQUNMLEtBQUs7aUNBQ0wsS0FBSzswQkFDTCxLQUFLO3lCQUNMLEtBQUs7O0lBMEhSLG1DQUFDO0NBQUEsQUFoSkQsSUFnSkM7U0FsSVksNEJBQTRCOzs7SUFDdkMsOENBQWdCOztJQUNoQix5REFBMkI7O0lBQzNCLGlEQUFtQjs7SUFDbkIsK0NBQWlCOztJQUNqQixpREFBbUI7O0lBQ25CLHNEQUF3Qjs7SUFDeEIsK0NBQTBCOztJQUMxQiw4Q0FBZ0I7O0lBQ2hCLDRDQUFZOztJQUNaLCtDQUFlOztJQUNmLDhDQUFzQjs7SUFDdEIsOENBQW1COztJQUNuQiwyQ0FFQzs7SUFFRCx1REFBbUM7Ozs7O0lBRHZCLDJDQUE2Qjs7Ozs7SUFBRSxnREFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBmb3J3YXJkUmVmLCBJbmplY3QsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IFNlbGVjdGlvblNlcnZpY2UgfSBmcm9tICcuLi9zZWxlY3Rpb24tYnktYXBpL3NlbGVjdGlvbi1ieS1hcGknO1xuZGVjbGFyZSBjb25zdCAkOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnbXVsdGktc2VsZWN0aW9uLWJ5LWFwaScsXG4gIHRlbXBsYXRlVXJsOiAnLi9tdWx0aS1zZWxlY3Rpb24tYnktYXBpLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbXVsdGktc2VsZWN0aW9uLWJ5LWFwaS5jb21wb25lbnQuY3NzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTXVsdGlTZWxlY3Rpb25CeUFwaUNvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH0sXG4gICAgU2VsZWN0aW9uU2VydmljZVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIE11bHRpU2VsZWN0aW9uQnlBcGlDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcbiAgQElucHV0KCkgX3ZhbHVlO1xuICBASW5wdXQoKSByZXN1bHRUcmFuc2Zvcm1lcjtcbiAgQElucHV0KCkgYXBpVXBsb2FkO1xuICBASW5wdXQoKSBoZWFkZXJzO1xuICBASW5wdXQoKSBmaWVsZE5hbWU7XG4gIEBJbnB1dCgpIGxlbmd0aFRvU2VhcmNoO1xuICBASW5wdXQoKSBpc0NsZWFyOiBCb29sZWFuO1xuICBASW5wdXQoKSBtZXRob2Q7XG4gIHB1YmxpYyB0ZXh0O1xuICBwdWJsaWMgb3B0aW9ucztcbiAgcHVibGljIGlzU2hvdyA9IGZhbHNlO1xuICBwdWJsaWMgcmVzdWx0ID0gW107XG4gIHB1YmxpYyB1cmwgPSAoYXBpVXJsLCBzZWFyY2gpID0+IHtcbiAgICByZXR1cm4gYXBpVXJsICsgdGhpcy5hcGlVcGxvYWQgKyBzZWFyY2g7XG4gIH1cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGk6IFNlbGVjdGlvblNlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7fVxuICBwcm9wYWdhdGVDaGFuZ2UgPSAodmFsOiBhbnkpID0+IHt9O1xuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGlmICh0aGlzLnZhbHVlKSB7XG4gICAgICAgIHRoaXMucmVzdWx0ID0gdGhpcy52YWx1ZTtcbiAgICAgIH1cbiAgICB9LCAxKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIGlmICh0aGlzLmlzQ2xlYXIgPT09IHRydWUpIHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnZhbHVlID0gW107XG4gICAgICAgIHRoaXMucmVzdWx0ID0gW107XG4gICAgICAgIF8uZm9yRWFjaCh0aGlzLm9wdGlvbnMsIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgdmFsdWUuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubWFwT3B0aW9uc1Jlc3VsdCh0aGlzLm9wdGlvbnMsIHRoaXMucmVzdWx0KTtcbiAgICAgIH0sIDEpO1xuICAgIH1cbiAgfVxuXG4gIGZpbHRlckRhdGEoZXZlbnQpIHtcbiAgICBjb25zdCBVUExPQURfRElSRUNUSVZFX0hFQURFUlMgPSB0aGlzLmluamVjdG9yLmdldCgnVVBMT0FEX0RJUkVDVElWRV9IRUFERVJTJyk7XG4gICAgY29uc3QgVVBMT0FEX0RJUkVDVElWRV9BUElfVVJMID0gdGhpcy5pbmplY3Rvci5nZXQoJ1VQTE9BRF9ESVJFQ1RJVkVfQVBJX1VSTCcpO1xuICAgIGlmIChldmVudC5sZW5ndGggPj0gdGhpcy5sZW5ndGhUb1NlYXJjaCkge1xuICAgICAgY29uc3QgYXBpID0gdGhpcy51cmwoVVBMT0FEX0RJUkVDVElWRV9BUElfVVJMLCBldmVudCk7XG4gICAgICBjb25zdCByZXF1ZXN0SGVhZGVycyA9IFVQTE9BRF9ESVJFQ1RJVkVfSEVBREVSUztcbiAgICAgIHRoaXMuYXBpLmdldEFsbChhcGksIHJlcXVlc3RIZWFkZXJzLCB0aGlzLm1ldGhvZCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gdGhpcy5yZXN1bHRUcmFuc2Zvcm1lcihyZXNwb25zZSk7XG4gICAgICAgIHRoaXMubWFwT3B0aW9uc1Jlc3VsdCh0aGlzLm9wdGlvbnMsIHRoaXMucmVzdWx0KTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5pc1Nob3cgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGRldGFpbENsaWNrKGl0ZW0pIHtcbiAgICBjb25zdCAkdGhpcyA9IHRoaXM7XG4gICAgaWYgKGl0ZW0uc2VsZWN0ZWQpIHtcbiAgICAgIF8ucmVtb3ZlKHRoaXMucmVzdWx0LCBmdW5jdGlvbihuKSB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShuKSA9PT0gSlNPTi5zdHJpbmdpZnkoaXRlbSk7XG4gICAgICB9KTtcbiAgICAgIF8uZm9yRWFjaCh0aGlzLm9wdGlvbnMsIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWx1ZSkgPT09IEpTT04uc3RyaW5naWZ5KGl0ZW0pKSB7XG4gICAgICAgICAgdmFsdWUuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLm1hcE9wdGlvbnNSZXN1bHQodGhpcy5vcHRpb25zLCB0aGlzLnJlc3VsdCk7XG4gICAgICB0aGlzLmlzU2hvdyA9IGZhbHNlO1xuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMucmVzdWx0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlc3VsdC5wdXNoKGl0ZW0pO1xuICAgICAgdGhpcy5tYXBPcHRpb25zUmVzdWx0KHRoaXMub3B0aW9ucywgdGhpcy5yZXN1bHQpO1xuICAgICAgdGhpcy5pc1Nob3cgPSBmYWxzZTtcbiAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnJlc3VsdDtcbiAgICB9XG4gIH1cblxuICBjaGFuZ2VTdGF0dXNPcHRpb25zKCkge1xuICAgIHRoaXMuaXNTaG93ID09PSBmYWxzZSA/ICh0aGlzLmlzU2hvdyA9IHRydWUpIDogKHRoaXMuaXNTaG93ID0gZmFsc2UpO1xuICB9XG5cbiAgX2lzRW1wdHkoYXJyYXkpIHtcbiAgICByZXR1cm4gXy5pc0VtcHR5KGFycmF5KSA/IHRydWUgOiBmYWxzZTtcbiAgfVxuXG4gIHJlbW92ZUl0ZW0oaXRlbSkge1xuICAgIGNvbnN0ICR0aGlzID0gdGhpcztcbiAgICBfLnJlbW92ZSh0aGlzLnJlc3VsdCwgZnVuY3Rpb24obikge1xuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG4pID09PSBKU09OLnN0cmluZ2lmeShpdGVtKTtcbiAgICB9KTtcbiAgICBfLmZvckVhY2godGhpcy5vcHRpb25zLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHZhbHVlKSA9PT0gSlNPTi5zdHJpbmdpZnkoaXRlbSkpIHtcbiAgICAgICAgdmFsdWUuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm1hcE9wdGlvbnNSZXN1bHQodGhpcy5vcHRpb25zLCB0aGlzLnJlc3VsdCk7XG4gICAgdGhpcy5pc1Nob3cgPSBmYWxzZTtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy5yZXN1bHQ7XG4gIH1cblxuICBtYXBPcHRpb25zUmVzdWx0KG9wdGlvbnMsIHJlc3VsdCkge1xuICAgIF8ubWFwKG9wdGlvbnMsIGl0ZW0gPT4ge1xuICAgICAgXy5mb3JFYWNoKHJlc3VsdCwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KGl0ZW0pID09PSBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpIHtcbiAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cblxuICBzZXQgdmFsdWUodmFsKSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWw7XG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UodGhpcy5fdmFsdWUpO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuKSB7XG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKCkge31cbn1cbiJdfQ==