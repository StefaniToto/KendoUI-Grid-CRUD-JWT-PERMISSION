/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { FormControlService } from '../../services/form-control.service';
import * as _ from 'lodash';
import { PhoneCode } from '../../models/PhoneCode';
import { TinyMce } from '../../models/TinyMce';
import { CheckBox } from '../../models/CheckBox';
import { SwitchInput } from '../../models/SwitchInput';
import { SelectionByApi } from '../../models/SelectionByApi';
import { Select2 } from '../../models/Select2';
import { ListCheckBox } from '../../models/ListCheckBox';
var ReactiveFormComponent = /** @class */ (function () {
    function ReactiveFormComponent(fcs) {
        this.fcs = fcs;
        this.groups = [];
        this.inputs = [];
        this.captchaCorrect = true;
        this.values = {};
        this.submitted = false;
        this.clear = false;
    }
    /**
     * @return {?}
     */
    ReactiveFormComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    ReactiveFormComponent.prototype.onChangesReactive = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var $this = this;
        if (this.keysChange !== undefined) {
            _.forEach(this.keysChange, (/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                $this.form.get(value).valueChanges.subscribe((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) {
                    $this.values[value] = val;
                    $this.form.value[value] = val;
                    $this.onChangeReactive.apply(null, [$this.form]);
                }));
            }));
        }
        else {
            this.form.valueChanges.subscribe((/**
             * @param {?} val
             * @return {?}
             */
            function (val) {
                if (_this.onChangeReactive !== undefined) {
                    _this.onChangeReactive.apply(null, [_this.form]);
                }
            }));
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ReactiveFormComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var groups = [];
        /** @type {?} */
        var grouped = _.groupBy(this.inputs, 'group');
        // tslint:disable-next-line:forin
        for (var k in grouped) {
            groups.push({
                group: k,
                items: grouped[k],
                classes: _.head(grouped[k]).group_classes
            });
        }
        this.groups = groups;
        this.form = this.fcs.toFormGroup(this.inputs);
        this.onChangesReactive();
    };
    /**
     * @return {?}
     */
    ReactiveFormComponent.prototype.submit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.submitted = true;
        if (this.form.invalid) {
            return false;
        }
        if (this.captcha && this.form.value["" + this.captcha].value !== this.form.value["" + this.captcha].code) {
            this.captchaCorrect = false;
            return false;
        }
        this.captchaCorrect = true;
        if (this.onSubmit !== undefined) {
            delete this.form.value[''];
            this.onSubmit.apply(null, [this.form]);
        }
        this.clear = false;
        if (!this.saveValue || this.saveValue === false) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.clearData();
            }), 2);
        }
    };
    /**
     * @return {?}
     */
    ReactiveFormComponent.prototype.resetFunction = /**
     * @return {?}
     */
    function () {
        if (confirm('Are you sure want to reset this form?')) {
            this.clearData();
        }
    };
    /**
     * @return {?}
     */
    ReactiveFormComponent.prototype.customSubmitFunction = /**
     * @return {?}
     */
    function () {
        this.submitted = true;
        if (this.form.invalid) {
            return false;
        }
        if (this.customSubmit !== undefined) {
            delete this.form.value[''];
            this.customSubmit.apply(null, [this.form]);
        }
        this.clear = false;
    };
    /**
     * @return {?}
     */
    ReactiveFormComponent.prototype.customButtonFunction = /**
     * @return {?}
     */
    function () {
        if (this.customButton !== undefined) {
            this.customButton.apply(null, []);
        }
    };
    /**
     * @return {?}
     */
    ReactiveFormComponent.prototype.clearData = /**
     * @return {?}
     */
    function () {
        this.clear = true;
        this.submitted = false;
        /** @type {?} */
        var data = {};
        _.forEach(this.inputs, (/**
         * @param {?} input
         * @return {?}
         */
        function (input) {
            if (input.controlType === new PhoneCode().controlType) {
                data[input.key] = {
                    code: '',
                    value: ''
                };
            }
            if (input.controlType === new TinyMce().controlType) {
                data[input.key] = '';
            }
            if (input.controlType === new CheckBox().controlType || input.controlType === new SwitchInput().controlType) {
                input.value = false;
            }
            if (input.controlType === new SelectionByApi().controlType) {
                input.value = null;
            }
            if (input.controlType === new Select2().controlType || input.controlType === new ListCheckBox().controlType) {
                input.value = [];
            }
        }));
        this.form.reset(data);
        _.forEach(this.inputs, (/**
         * @param {?} input
         * @return {?}
         */
        function (input) {
            if (input.controlType === new CheckBox().controlType || input.controlType === new SwitchInput().controlType) {
                input.value = false;
            }
            if (input.controlType === new SelectionByApi().controlType) {
                input.value = null;
            }
            if (input.controlType === new Select2().controlType || input.controlType === new ListCheckBox().controlType) {
                input.value = [];
            }
        }));
        this.form.markAsPristine();
        this.form.markAsUntouched();
    };
    ReactiveFormComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'reactive-form',
                    template: "<form (ngSubmit)=\"submit()\" [formGroup]=\"form\">\r\n  <div class=\"row\">\r\n    <div class=\"dynamic-collection\" *ngFor=\"let group of groups\" [ngClass]=\"group.classes\">\r\n      <div class=\"row\">\r\n        <div *ngFor=\"let input of group.items\" class=\"dynamic-input-group\" [ngClass]=\"input.classes\">\r\n          <dynamic-input\r\n            [captchaCorrect]=\"captchaCorrect\"\r\n            [isClear]=\"clear\"\r\n            [input]=\"input\"\r\n            [form]=\"form\"\r\n            [submitted]=\"submitted\"\r\n          ></dynamic-input>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"dynamic-submit-btn\">\r\n    <button type=\"submit\" [ngClass]=\"{ disabled: !form.valid }\" class=\"btn btn-primary m-r-15 ripple light\">\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ submitText !== undefined ? submitText : 'Submit' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"isReset !== undefined && isReset === true\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"resetFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ resetText !== undefined ? resetText : 'Reset' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"customSubmit !== undefined\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"customSubmitFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ customeSubmitText !== undefined ? customeSubmitText : 'Custom Submit' }}\r\n    </button>\r\n    <button\r\n      *ngIf=\"customButton !== undefined\"\r\n      type=\"button\"\r\n      class=\"btn btn-primary m-r-15 ripple light btn-reset\"\r\n      (click)=\"customButtonFunction()\"\r\n    >\r\n      <i class=\"icofont icofont-plus m-r-5\"></i> {{ customButtonText !== undefined ? customButtonText : 'Custom Button' }}\r\n    </button>\r\n  </div>\r\n</form>\r\n",
                    providers: [FormControlService],
                    styles: [":host .dynamic-collection{margin-bottom:10px}:host .btn-reset{float:right}:host .rf__captcha--error{margin-top:15px;color:#e74c3c;font-size:15px}"]
                }] }
    ];
    /** @nocollapse */
    ReactiveFormComponent.ctorParameters = function () { return [
        { type: FormControlService }
    ]; };
    ReactiveFormComponent.propDecorators = {
        inputs: [{ type: Input }],
        onSubmit: [{ type: Input }],
        submitText: [{ type: Input }],
        onChangeReactive: [{ type: Input }],
        keysChange: [{ type: Input }],
        isReset: [{ type: Input }],
        resetText: [{ type: Input }],
        customSubmit: [{ type: Input }],
        customButton: [{ type: Input }],
        customeSubmitText: [{ type: Input }],
        customButtonText: [{ type: Input }],
        saveValue: [{ type: Input }],
        captcha: [{ type: Input }]
    };
    return ReactiveFormComponent;
}());
export { ReactiveFormComponent };
if (false) {
    /** @type {?} */
    ReactiveFormComponent.prototype.groups;
    /** @type {?} */
    ReactiveFormComponent.prototype.inputs;
    /** @type {?} */
    ReactiveFormComponent.prototype.onSubmit;
    /** @type {?} */
    ReactiveFormComponent.prototype.submitText;
    /** @type {?} */
    ReactiveFormComponent.prototype.onChangeReactive;
    /** @type {?} */
    ReactiveFormComponent.prototype.keysChange;
    /** @type {?} */
    ReactiveFormComponent.prototype.isReset;
    /** @type {?} */
    ReactiveFormComponent.prototype.resetText;
    /** @type {?} */
    ReactiveFormComponent.prototype.customSubmit;
    /** @type {?} */
    ReactiveFormComponent.prototype.customButton;
    /** @type {?} */
    ReactiveFormComponent.prototype.customeSubmitText;
    /** @type {?} */
    ReactiveFormComponent.prototype.customButtonText;
    /** @type {?} */
    ReactiveFormComponent.prototype.saveValue;
    /** @type {?} */
    ReactiveFormComponent.prototype.captcha;
    /** @type {?} */
    ReactiveFormComponent.prototype.captchaCorrect;
    /** @type {?} */
    ReactiveFormComponent.prototype.values;
    /** @type {?} */
    ReactiveFormComponent.prototype.form;
    /** @type {?} */
    ReactiveFormComponent.prototype.submitted;
    /** @type {?} */
    ReactiveFormComponent.prototype.clear;
    /**
     * @type {?}
     * @private
     */
    ReactiveFormComponent.prototype.fcs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhY3RpdmUtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXJlYWN0aXZlLWZvcm0vIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9yZWFjdGl2ZS1mb3JtL3JlYWN0aXZlLWZvcm0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFbkYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDekUsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFFNUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRXpEO0lBNEJFLCtCQUFvQixHQUF1QjtRQUF2QixRQUFHLEdBQUgsR0FBRyxDQUFvQjtRQXBCM0MsV0FBTSxHQUFxQixFQUFFLENBQUM7UUFDckIsV0FBTSxHQUFxQixFQUFFLENBQUM7UUFhdkMsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFFdEIsV0FBTSxHQUFRLEVBQUUsQ0FBQztRQUVqQixjQUFTLEdBQVksS0FBSyxDQUFDO1FBQzNCLFVBQUssR0FBWSxLQUFLLENBQUM7SUFDdUIsQ0FBQzs7OztJQUUvQyx3Q0FBUTs7O0lBQVIsY0FBWSxDQUFDOzs7O0lBRWIsaURBQWlCOzs7SUFBakI7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Qjs7SUFDM0IsMENBQTRCOztJQUM1Qiw2Q0FBaUM7O0lBQ2pDLDZDQUFpQzs7SUFDakMsa0RBQW9DOztJQUNwQyxpREFBbUM7O0lBQ25DLDBDQUE2Qjs7SUFDN0Isd0NBQTBCOztJQUMxQiwrQ0FBc0I7O0lBRXRCLHVDQUFpQjs7SUFDakIscUNBQWdCOztJQUNoQiwwQ0FBMkI7O0lBQzNCLHNDQUF1Qjs7Ozs7SUFDWCxvQ0FBK0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBJbnB1dEJhc2UgfSBmcm9tICcuLi8uLi9tb2RlbHMvSW5wdXRCYXNlJztcclxuaW1wb3J0IHsgRm9ybUNvbnRyb2xTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZm9ybS1jb250cm9sLnNlcnZpY2UnO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcbmltcG9ydCB7IEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgUGhvbmVDb2RlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL1Bob25lQ29kZSc7XHJcbmltcG9ydCB7IFRpbnlNY2UgfSBmcm9tICcuLi8uLi9tb2RlbHMvVGlueU1jZSc7XHJcbmltcG9ydCB7IENoZWNrQm94IH0gZnJvbSAnLi4vLi4vbW9kZWxzL0NoZWNrQm94JztcclxuaW1wb3J0IHsgU3dpdGNoSW5wdXQgfSBmcm9tICcuLi8uLi9tb2RlbHMvU3dpdGNoSW5wdXQnO1xyXG5pbXBvcnQgeyBTZWxlY3Rpb25CeUFwaSB9IGZyb20gJy4uLy4uL21vZGVscy9TZWxlY3Rpb25CeUFwaSc7XHJcbmltcG9ydCB7IFNlbGVjdDIgfSBmcm9tICcuLi8uLi9tb2RlbHMvU2VsZWN0Mic7XHJcbmltcG9ydCB7IExpc3RDaGVja0JveCB9IGZyb20gJy4uLy4uL21vZGVscy9MaXN0Q2hlY2tCb3gnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxyXG4gIHNlbGVjdG9yOiAncmVhY3RpdmUtZm9ybScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3JlYWN0aXZlLWZvcm0uY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3JlYWN0aXZlLWZvcm0uY29tcG9uZW50LnNjc3MnXSxcclxuICBwcm92aWRlcnM6IFtGb3JtQ29udHJvbFNlcnZpY2VdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBSZWFjdGl2ZUZvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgZ3JvdXBzOiBJbnB1dEJhc2U8YW55PltdID0gW107XHJcbiAgQElucHV0KCkgaW5wdXRzOiBJbnB1dEJhc2U8YW55PltdID0gW107XHJcbiAgQElucHV0KCkgb25TdWJtaXQ/OiBGdW5jdGlvbjtcclxuICBASW5wdXQoKSBzdWJtaXRUZXh0PzogU3RyaW5nO1xyXG4gIEBJbnB1dCgpIG9uQ2hhbmdlUmVhY3RpdmU/OiBGdW5jdGlvbjtcclxuICBASW5wdXQoKSBrZXlzQ2hhbmdlPzogYW55O1xyXG4gIEBJbnB1dCgpIGlzUmVzZXQ/OiBCb29sZWFuO1xyXG4gIEBJbnB1dCgpIHJlc2V0VGV4dD86IFN0cmluZztcclxuICBASW5wdXQoKSBjdXN0b21TdWJtaXQ/OiBGdW5jdGlvbjtcclxuICBASW5wdXQoKSBjdXN0b21CdXR0b24/OiBGdW5jdGlvbjtcclxuICBASW5wdXQoKSBjdXN0b21lU3VibWl0VGV4dD86IFN0cmluZztcclxuICBASW5wdXQoKSBjdXN0b21CdXR0b25UZXh0PzogU3RyaW5nO1xyXG4gIEBJbnB1dCgpIHNhdmVWYWx1ZT86IEJvb2xlYW47XHJcbiAgQElucHV0KCkgY2FwdGNoYT86IFN0cmluZztcclxuICBjYXB0Y2hhQ29ycmVjdCA9IHRydWU7XHJcblxyXG4gIHZhbHVlczogYW55ID0ge307XHJcbiAgZm9ybTogRm9ybUdyb3VwO1xyXG4gIHN1Ym1pdHRlZDogQm9vbGVhbiA9IGZhbHNlO1xyXG4gIGNsZWFyOiBCb29sZWFuID0gZmFsc2U7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmY3M6IEZvcm1Db250cm9sU2VydmljZSkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7fVxyXG5cclxuICBvbkNoYW5nZXNSZWFjdGl2ZSgpIHtcclxuICAgIGNvbnN0ICR0aGlzID0gdGhpcztcclxuICAgIGlmICh0aGlzLmtleXNDaGFuZ2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBfLmZvckVhY2godGhpcy5rZXlzQ2hhbmdlLCBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICR0aGlzLmZvcm0uZ2V0KHZhbHVlKS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHZhbCA9PiB7XHJcbiAgICAgICAgICAkdGhpcy52YWx1ZXNbdmFsdWVdID0gdmFsO1xyXG4gICAgICAgICAgJHRoaXMuZm9ybS52YWx1ZVt2YWx1ZV0gPSB2YWw7XHJcbiAgICAgICAgICAkdGhpcy5vbkNoYW5nZVJlYWN0aXZlLmFwcGx5KG51bGwsIFskdGhpcy5mb3JtXSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5mb3JtLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsID0+IHtcclxuICAgICAgICBpZiAodGhpcy5vbkNoYW5nZVJlYWN0aXZlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIHRoaXMub25DaGFuZ2VSZWFjdGl2ZS5hcHBseShudWxsLCBbdGhpcy5mb3JtXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGNvbnN0IGdyb3VwcyA9IFtdO1xyXG4gICAgY29uc3QgZ3JvdXBlZCA9IF8uZ3JvdXBCeSh0aGlzLmlucHV0cywgJ2dyb3VwJyk7XHJcblxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmZvcmluXHJcbiAgICBmb3IgKGNvbnN0IGsgaW4gZ3JvdXBlZCkge1xyXG4gICAgICBncm91cHMucHVzaCh7XHJcbiAgICAgICAgZ3JvdXA6IGssXHJcbiAgICAgICAgaXRlbXM6IGdyb3VwZWRba10sXHJcbiAgICAgICAgY2xhc3NlczogXy5oZWFkKGdyb3VwZWRba10pLmdyb3VwX2NsYXNzZXNcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmdyb3VwcyA9IGdyb3VwcztcclxuICAgIHRoaXMuZm9ybSA9IHRoaXMuZmNzLnRvRm9ybUdyb3VwKHRoaXMuaW5wdXRzKTtcclxuICAgIHRoaXMub25DaGFuZ2VzUmVhY3RpdmUoKTtcclxuICB9XHJcblxyXG4gIHN1Ym1pdCgpIHtcclxuICAgIHRoaXMuc3VibWl0dGVkID0gdHJ1ZTtcclxuICAgIGlmICh0aGlzLmZvcm0uaW52YWxpZCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5jYXB0Y2hhICYmIHRoaXMuZm9ybS52YWx1ZVtgJHt0aGlzLmNhcHRjaGF9YF0udmFsdWUgIT09IHRoaXMuZm9ybS52YWx1ZVtgJHt0aGlzLmNhcHRjaGF9YF0uY29kZSkge1xyXG4gICAgICB0aGlzLmNhcHRjaGFDb3JyZWN0ID0gZmFsc2U7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHRoaXMuY2FwdGNoYUNvcnJlY3QgPSB0cnVlO1xyXG5cclxuICAgIGlmICh0aGlzLm9uU3VibWl0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgZGVsZXRlIHRoaXMuZm9ybS52YWx1ZVsnJ107XHJcbiAgICAgIHRoaXMub25TdWJtaXQuYXBwbHkobnVsbCwgW3RoaXMuZm9ybV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2xlYXIgPSBmYWxzZTtcclxuXHJcbiAgICBpZiAoIXRoaXMuc2F2ZVZhbHVlIHx8IHRoaXMuc2F2ZVZhbHVlID09PSBmYWxzZSkge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmNsZWFyRGF0YSgpO1xyXG4gICAgICB9LCAyKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlc2V0RnVuY3Rpb24oKSB7XHJcbiAgICBpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHdhbnQgdG8gcmVzZXQgdGhpcyBmb3JtPycpKSB7XHJcbiAgICAgIHRoaXMuY2xlYXJEYXRhKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjdXN0b21TdWJtaXRGdW5jdGlvbigpIHtcclxuICAgIHRoaXMuc3VibWl0dGVkID0gdHJ1ZTtcclxuICAgIGlmICh0aGlzLmZvcm0uaW52YWxpZCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5jdXN0b21TdWJtaXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBkZWxldGUgdGhpcy5mb3JtLnZhbHVlWycnXTtcclxuICAgICAgdGhpcy5jdXN0b21TdWJtaXQuYXBwbHkobnVsbCwgW3RoaXMuZm9ybV0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jbGVhciA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgY3VzdG9tQnV0dG9uRnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy5jdXN0b21CdXR0b24gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLmN1c3RvbUJ1dHRvbi5hcHBseShudWxsLCBbXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGVhckRhdGEoKSB7XHJcbiAgICB0aGlzLmNsZWFyID0gdHJ1ZTtcclxuICAgIHRoaXMuc3VibWl0dGVkID0gZmFsc2U7XHJcbiAgICBjb25zdCBkYXRhID0ge307XHJcbiAgICBfLmZvckVhY2godGhpcy5pbnB1dHMsIGlucHV0ID0+IHtcclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgUGhvbmVDb2RlKCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBkYXRhW2lucHV0LmtleV0gPSB7XHJcbiAgICAgICAgICBjb2RlOiAnJyxcclxuICAgICAgICAgIHZhbHVlOiAnJ1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgVGlueU1jZSgpLmNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgZGF0YVtpbnB1dC5rZXldID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgQ2hlY2tCb3goKS5jb250cm9sVHlwZSB8fCBpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFN3aXRjaElucHV0KCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpbnB1dC5jb250cm9sVHlwZSA9PT0gbmV3IFNlbGVjdGlvbkJ5QXBpKCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgU2VsZWN0MigpLmNvbnRyb2xUeXBlIHx8IGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgTGlzdENoZWNrQm94KCkuY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IFtdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuZm9ybS5yZXNldChkYXRhKTtcclxuICAgIF8uZm9yRWFjaCh0aGlzLmlucHV0cywgaW5wdXQgPT4ge1xyXG4gICAgICBpZiAoaW5wdXQuY29udHJvbFR5cGUgPT09IG5ldyBDaGVja0JveCgpLmNvbnRyb2xUeXBlIHx8IGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgU3dpdGNoSW5wdXQoKS5jb250cm9sVHlwZSkge1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlucHV0LmNvbnRyb2xUeXBlID09PSBuZXcgU2VsZWN0aW9uQnlBcGkoKS5jb250cm9sVHlwZSkge1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaW5wdXQuY29udHJvbFR5cGUgPT09IG5ldyBTZWxlY3QyKCkuY29udHJvbFR5cGUgfHwgaW5wdXQuY29udHJvbFR5cGUgPT09IG5ldyBMaXN0Q2hlY2tCb3goKS5jb250cm9sVHlwZSkge1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gW107XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuZm9ybS5tYXJrQXNQcmlzdGluZSgpO1xyXG4gICAgdGhpcy5mb3JtLm1hcmtBc1VudG91Y2hlZCgpO1xyXG4gIH1cclxufVxyXG4iXX0=